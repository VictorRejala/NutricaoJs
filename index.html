<!DOCTYPE html>

<html lang="pt-br">

	<head>

		<meta charset="UTF-8">
		<title>Stephanie Nutrição</title>
		<link rel="icon" href="favicon.ico" type="image/x-icon">
		<link rel="stylesheet" type="text/css" href="css/reset.css">
		<link rel="stylesheet" type="text/css" href="css/index.css">

	</head>
	
	<body>

		<header>

			<div class="container">

				<h1 class="titulo">Stephanie Nutrição</h1>

			</div>

		</header>

		<main>

			<section class="container">

				<h2>Meus pacientes</h2>

				<button id="mudar-modo">&#9728;</button>

				<input type="text" name="filtro" id="filtrar-tabela" placeholder="Digite o nome do paciente que deseja procurar">
				<p class="informacao">Para apagar os dados do paciente, clique duas vezes nele</p>

				<table>

					<thead>

						<tr>

							<th>Nome</th>
							<th>Peso(kg)</th>
							<th>Altura(m)</th>
							<th>Gordura Corporal(%)</th>
							<th>IMC</th>

						</tr>

					</thead>

					<tbody id="tabela-pacientes">

						<tr class="paciente" id="primeiro-paciente">

							<td class="info-nome">Paulo</td>
							<td class="info-peso">-100</td>
							<td class="info-altura">2.00</td>
							<td class="info-gordura">10</td>
							<td class="info-imc">0</td>
					
						</tr>

						<tr class="paciente" >

							<td class="info-nome">João</td>
							<td class="info-peso">80</td>
							<td class="info-altura">1.72</td>
							<td class="info-gordura">40</td>
							<td class="info-imc">0</td>

						</tr>

						<tr class="paciente" >

							<td class="info-nome">Erica</td>
							<td class="info-peso">54</td>
							<td class="info-altura">1.64</td>
							<td class="info-gordura">14</td>
							<td class="info-imc">0</td>

						</tr>

						<tr class="paciente">

							<td class="info-nome">Douglas</td>
							<td class="info-peso">85</td>
							<td class="info-altura">1.65</td>
							<td class="info-gordura">40</td>
							<td class="info-imc">0</td>
						
						</tr>

						<tr class="paciente" >

							<td class="info-nome">Tatiana</td>
							<td class="info-peso">46</td>
							<td class="info-altura">1.55</td>
							<td class="info-gordura">19</td>
							<td class="info-imc">0</td>

						</tr>

					</tbody>

				</table>

			</section>

		</main>

		<section class= "container">

			<h2 id="titulo-form" class="adicionar-paciente">Adicionar novo paciente</h2>

			<ul id = "mensagens-erro"></ul>

			<form id = "form-adiciona">

				<div class="grupo">

					<label for="nome">Nome:</label>
					<input id="nome" name="nome" type="text" placeholder="Digite o nome do seu paciente" class="campo" required>

				</div>

				<div class="grupo">

					<label for="peso">Peso:</label>
					<input id="peso" name="peso" type="text" placeholder="Digite o peso do seu paciente" class="campo campo-medio">
				
				</div>
				
				<div class="grupo">

					<label for="altura">Altura:</label>
					<input id="altura" name="altura" type="text" placeholder="Digite a altura do seu paciente em metros" class="campo campo-medio">
				
				</div>
				
				<div class="grupo">
				
					<label for="gordura">% de Gordura:</label>
					<input id="gordura" type="text" placeholder="Digite a porcentagem de gordura do seu paciente" class="campo campo-medio">
				
				</div>

				<button id="adicionar-paciente" class="botao bto-principal">Adicionar</button>
			
			</form>
		
		</section>


			
		
		<script>
		
			//src="js/calcula-imc.js"

			var titulo = document.querySelector (".titulo");
			titulo.textContent = "Stephanie Nutrição";

			var pacientes = document.querySelectorAll (".paciente");

			function calculaImc (peso, altura) {
				
				var imc;
				imc = peso / (altura * altura);

				return imc.toFixed(2);
			}

			for(i = 0; i < pacientes.length; i++) {
				
				var trPaciente = pacientes [i];
				
				var tdPeso = trPaciente.querySelector (".info-peso");
				var peso = tdPeso.textContent;

				var tdAltura = trPaciente.querySelector (".info-altura");
				var altura = tdAltura.textContent;

				var tdImc = trPaciente.querySelector (".info-imc");

				pesoEhValido = validaPeso(peso);
				alturaEhValida = validaAltura(altura);

				if (!pesoEhValido) {

					tdImc.textContent = "Peso inválido";
					trPaciente.classList.add ("paciente-invalido");
				}

				if (!alturaEhValida) {

					tdImc.textContent = "Altura inválida";
					trPaciente.classList.add ("paciente-invalido");
				}

				if (pesoEhValido && alturaEhValida) {

					tdImc.textContent = calculaImc(peso, altura);
				}
			}

			function validaPeso (peso) {

				if ( peso >= 0 && peso <= 1000) {

					return true;
				} else {

					return false;
				}
			}

			function validaAltura (altura) {

				if ( altura >= 0 && altura <= 3.00) {

					return true;
				} else {

					return false;
				}
			}

		</script>	

		<script>

			//src="js/form.js"

			var botaoAdicionar = document.querySelector ("#adicionar-paciente");

			botaoAdicionar.addEventListener("click", function (event){
				
				event.preventDefault();
				
				var form = document.querySelector("#form-adiciona");

				var paciente = obtemPacienteDoFormulario(form);

				var erros = validaPaciente(paciente);

				if (erros.length > 0) {

					exibeMensagensDeErro(erros);
					return;
				}

				var pacienteTr = montaTr(paciente);

				var tabela = document.querySelector("#tabela-pacientes");

				tabela.appendChild(pacienteTr);

				var mensagensErro = document.querySelector("#mensagens-erro");
				mensagensErro.innerHTML = "";

				form.reset();
			});

			function obtemPacienteDoFormulario (form) {

				var paciente = {

					nome: form.nome.value,
					peso: form.peso.value,
					altura: form.altura.value,
					gordura: form.gordura.value,
					imc: calculaImc(form.peso.value, form.altura.value)
				}

				return paciente;
			}

			function montaTr (paciente) {

				var pacienteTr = document.createElement("tr");
				pacienteTr.classList.add("paciente"); 

				pacienteTr.appendChild (montaTd(paciente.nome, "info-nome"));
				pacienteTr.appendChild (montaTd(paciente.peso, "info-peso"));
				pacienteTr.appendChild (montaTd(paciente.altura, "info-altura"));
				pacienteTr.appendChild (montaTd(paciente.gordura, "info-gordura"));
				pacienteTr.appendChild (montaTd(paciente.imc, "info-imc"));

				return pacienteTr;
			}

			function montaTd (dado, classe) {

				var td = document.createElement("td");
				
				td.textContent = dado;

				td.classList.add(classe);

				return td;
			}

			function validaPaciente (paciente) {

				var erros = [];

				if (paciente.nome.length == 0) {

					erros.push("O nome não pode ser em branco");
				}

				if (paciente.peso.length == 0) {

					erros.push("O peso não pode ser em branco");
				}

				if (paciente.altura.length == 0) {

					erros.push("A altura não pode ser em branco");
				}

				if (paciente.gordura.length == 0) {

					erros.push("A gordura não pode ser em branco");
				}

				if (!validaPeso(paciente.peso)) {

					erros.push("Peso inválido");
				}

				if (!validaAltura(paciente.altura)) {

					erros.push("Altura inválida");
				}

				return erros;
			}

			function exibeMensagensDeErro (erros) {

				var ul = document.querySelector("#mensagens-erro");
				ul.innerHTML = "";

				erros.forEach (function(erro) {

					var li = document.createElement("li");
					li.textContent = erro;
					ul.appendChild(li);
				})
			}

		</script>

		<script>

			//src="js/remove-paciente.js"

			var tabela = document.querySelector("#tabela-pacientes");

			tabela.addEventListener("dblclick", function (event) {

				event.target.parentNode.classList.add("fadeOut");

				setTimeout(function() {

					event.target.parentNode.remove();
				}, 500);
			});

		</script>

		<script>

			//src="js/filtra.js"

			var campoFiltro = document.querySelector("#filtrar-tabela");

			campoFiltro.addEventListener("input", function() {

				var pacientes = document.querySelectorAll(".paciente");

				if (this.value.length > 0) {

					for (var i = 0; i < pacientes.length; i++) {

						var paciente = pacientes[i];

						var tdNome = paciente.querySelector(".info-nome");
						var nome = tdNome.textContent;

						var expressao = new RegExp(this.value, "i");

						if (expressao.test(nome)) {

							paciente.classList.remove("invisivel");
						} else {

							paciente.classList.add("invisivel")
						}
					}
				} else {

					for (var i = 0; i < pacientes.length; i++) {

						var paciente = pacientes[i];
						paciente.classList.remove("invisivel");
					}
				}
			});

		</script>

		<script>

			//src="js/muda-cor.js"

			var botaoCor = document.querySelector("#mudar-modo");

			botaoCor.addEventListener("click", mudarCor);


			function mudarCor(event) {

				event.preventDefault;

				var body = document.querySelector("body");
				var header = document.querySelector("header");
				var sectionH2 = document.querySelector("section h2");
				var informacao = document.querySelector(".informacao");
				var campo = document.querySelectorAll(".campo");
				var td = document.querySelectorAll("td");
				var th = document.querySelectorAll("th");
				var addpaciente = document.querySelector(".adicionar-paciente");
				var label = document.querySelectorAll("label");

				body.classList.toggle("light-body");
				header.classList.toggle("light-header");
				sectionH2.classList.toggle("light-section");
				informacao.classList.toggle("light-informacao");
				addpaciente.classList.toggle("light-section");

				for (i=0; i < campo.length; i++) {

					var campos = campo[i];

					campos.classList.toggle("light-campo");
				}

				for (i=0; i < td.length; i++) {

					var tds = td[i];

					tds.classList.toggle("light-td");
				}

				for (i=0; i < th.length; i++) {

					var ths = th[i];

					ths.classList.toggle("light-th");
				}

				for (i=0; i < label.length; i++) {

					var labels = label[i];

					labels.classList.toggle("light-informacao");
				}
			}  

		</script>	

	</body>

</html>